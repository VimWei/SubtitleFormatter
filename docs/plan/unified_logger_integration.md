# UnifiedLogger 集成计划

## 📋 概述

确保现有的优秀日志系统 `UnifiedLogger` 和 `DebugOutput` 能够完美兼容新的内核流程，保持统一的日志管理和调试输出功能。

**文档定位**: 本文档专注于**UnifiedLogger集成**，是主重构计划的子任务。整体实施计划请参考 [主重构计划](src_refactor_plan.md)，基础设施架构请参考 [基础设施架构文档](infrastructure_architecture.md)。

## 🔍 现状分析

### UnifiedLogger 优势
- ✅ 统一的终端和GUI日志输出
- ✅ 支持简洁模式和详细模式
- ✅ 自动时间戳和日志级别
- ✅ 完善的进度和统计信息显示
- ✅ 调试模式控制

### DebugOutput 优势
- ✅ 处理步骤的中间结果文件保存
- ✅ 生成详细的处理日志文件
- ✅ 自动步骤序号管理
- ✅ 统计信息收集和展示

## 🎯 集成目标

### 保持现有功能
- 🔄 所有新组件使用统一的日志接口
- 📁 保持调试文件保存功能
- 🎯 保持GUI和终端同步输出
- 📊 保持统计信息展示

### 适配新流程
- 🔧 适配新的处理步骤名称
- 📝 更新统计信息收集逻辑
- 🎨 保持日志格式一致性

## 📝 详细实施计划

### 阶段一：接口适配 (1天)

#### 1.1 新组件日志集成
- 确保所有新组件使用 `UnifiedLogger`
- 统一日志消息格式
- 保持现有的日志级别分类

#### 1.2 DebugOutput 适配
- 更新处理步骤名称映射
- 适配新的统计信息结构
- 保持文件保存功能

### 阶段二：功能验证 (1天)

#### 2.1 日志功能测试
- 测试终端输出功能
- 测试GUI日志面板功能
- 测试调试模式切换

#### 2.2 调试输出测试
- 测试中间结果文件保存
- 测试处理日志生成
- 测试统计信息展示

## 🔧 技术实现要点

### 1. 新组件日志集成
```python
# 在新组件中使用统一日志
from ..utils.unified_logger import logger

class PunctuationAdder:
    def process(self, text):
        logger.step("标点恢复", "开始处理文本")
        # ... 处理逻辑 ...
        logger.stats("标点恢复统计", stats_dict)
```

### 2. DebugOutput 适配
```python
# 更新步骤名称映射 - 使用完整的命名空间引用
step_mappings = {
    "标点恢复": "builtin/punctuation_adder",
    "句子分割": "builtin/text_to_sentences", 
    "句子拆分": "builtin/sentence_splitter"
}
```

### 3. 统计信息收集
- 保持现有的统计信息结构
- 适配新组件的输出格式
- 保持统计信息的完整性

## 📚 参考文档

- `src/subtitleformatter/utils/unified_logger.py` - 统一日志系统
- `src/subtitleformatter/utils/debug_output.py` - 调试输出系统

## ⚠️ 注意事项

### 兼容性
- 确保现有GUI功能不受影响
- 保持日志格式的一致性
- 确保调试功能正常工作

### 性能
- 避免日志输出影响处理性能
- 合理控制调试信息的详细程度
- 优化文件I/O操作

## 🚀 实施时间表

| 阶段 | 任务 | 预计时间 | 优先级 |
|------|------|----------|--------|
| 1 | 接口适配 | 1天 | 高 |
| 2 | 功能验证 | 1天 | 高 |
| **总计** | | **2天** | **高** |

## 📋 验收标准

### 功能验收
- [ ] 所有新组件使用统一日志
- [ ] GUI日志面板正常显示
- [ ] 调试文件保存功能正常
- [ ] 统计信息展示完整

### 兼容性验收
- [ ] 现有GUI功能不受影响
- [ ] 日志格式保持一致
- [ ] 调试模式正常工作

---

**注意**: 此计划为高优先级事项，需要在主要重构过程中同步进行。
